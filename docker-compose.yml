version: '3'
services:
  deepstream:
    # 3.1.0 (latest), v4.0.0-rc.2-alpine (NOTE: v4 login not working)
    image: deepstreamio/deepstream.io:3.1.0
    ports:
      - "6020:6020"
      - "8080:8080"
    volumes:
      - ./deepstream/conf:/opt/deepstream/conf
    #command: ./deepstream start --disable-auth --disable-permissions

  .deepstream-client: &deepstream-client  
    build:
      context: ./
      args:
        http_proxy: ${http_proxy}
        https_proxy: ${http_proxy}
        no_proxy: ${no_proxy}
    environment:
      DEEPSTREAM_URL: deepstream:6020
      DEEPSTREAM_USER: userA
      DEEPSTREAM_PWD: ${DEEPSTREAM_PWD}
      DEEPSTREAM_EVENT: test
    depends_on:
      - deepstream

  dotnet:
    <<: *deepstream-client   
    build:
      context: ./dotnet

  java:
    <<: *deepstream-client   
    build:
      context: ./java
      args:
        JAVA_OPTS: ${JAVA_OPTS}

  java-builder:
    image: gradle:4.5.0-jdk8-alpine
    environment:
      http_proxy: ${http_proxy}
      https_proxy: ${http_proxy}
      no_proxy: ${no_proxy}
      JAVA_OPTS: ${JAVA_OPTS}
    volumes:
      - ./java/:/home/gradle/
    command: ash
